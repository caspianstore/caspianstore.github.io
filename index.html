<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Caspian Store | Public Pro</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root {
        --bg: #242424; --card: #2c2c2e; --primary: #0A84FF; --accent: #30D158;
        --danger: #FF453A; --gold: #FFD700; --text: #FFFFFF; --glass: rgba(36, 36, 36, 0.95);
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    body { background-color: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; padding-bottom: 90px; overflow-x: hidden; user-select: none; }

    /* Animasiyalar */
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes pulse-gold { 0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }

    /* Ban EkranÄ± */
    #ban-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 99999; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
    
    /* Start EkranÄ± */
    #start-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9000; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }

    /* Header */
    header { position: fixed; top: 0; left: 0; right: 0; padding: 15px 20px; background: var(--glass); backdrop-filter: blur(10px); z-index: 100; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 20px; font-weight: 800; letter-spacing: -0.5px; }
    .id-badge { font-size: 12px; background: #333; padding: 5px 10px; border-radius: 20px; color: #ccc; cursor: pointer; }
    .search-box { flex: 1; margin: 0 15px; }
    .search-box input { width: 100%; padding: 8px 12px; background: #333; border: none; border-radius: 10px; color: white; font-size: 12px; }

    /* Kateqoriyalar */
    .cat-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 80px 15px 10px 15px; scrollbar-width: none; }
    .cat-item { background: #333; padding: 8px 16px; border-radius: 20px; white-space: nowrap; font-size: 13px; font-weight: 600; color: #ccc; transition: 0.3s; cursor: pointer; }
    .cat-item.active { background: var(--text); color: black; }

    /* Elan KartÄ± */
    .container { padding: 10px 15px; }
    .ad-card { background: var(--card); border-radius: 16px; margin-bottom: 20px; overflow: hidden; position: relative; border: 1px solid #333; animation: fadeIn 0.5s ease; cursor: pointer; }
    .ad-card.hot { border: 2px solid var(--gold); animation: pulse-gold 2s infinite; }
    .hot-badge { position: absolute; top: 10px; right: 10px; background: var(--gold); color: black; font-weight: bold; font-size: 10px; padding: 4px 8px; border-radius: 8px; z-index: 5; }
    .sold-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 10; font-size: 24px; font-weight: bold; color: var(--danger); transform: rotate(-15deg); border: 4px solid var(--danger); }

    .slider-container { position: relative; width: 100%; height: 220px; background: #000; }
    .slider-img { width: 100%; height: 100%; object-fit: cover; display: none; }
    .slider-img.active { display: block; }
    .ad-content { padding: 15px; }
    .ad-price { font-size: 20px; font-weight: 700; color: var(--accent); }
    .ad-title { font-size: 17px; margin: 5px 0; font-weight: 600; }

    /* DÃ¼ymÉ™lÉ™r */
    .btn { width: 100%; padding: 12px; border-radius: 12px; border: none; font-weight: 600; margin-top: 8px; cursor: pointer; }
    .btn-primary { background: var(--primary); color: white; }
    .btn-gold { background: linear-gradient(135deg, #FFD700, #FFA500); color: black; }
    .btn-glass { background: rgba(255,255,255,0.1); color: white; }
    .btn-danger { background: rgba(255, 69, 58, 0.2); color: var(--danger); }
    .btn-mini { padding: 6px 10px; font-size: 11px; margin: 4px 4px 4px 0; background: #333; color: white; border: none; border-radius: 8px; cursor: pointer; }

    /* Modallar */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); z-index: 2000; display: none; align-items: flex-end; }
    .modal-content { background: #1c1c1e; width: 100%; padding: 25px 20px 40px 20px; border-radius: 25px 25px 0 0; animation: slideUp 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); max-height: 90vh; overflow-y: auto; }
    .modal-handle { width: 40px; height: 5px; background: #444; margin: 0 auto 20px auto; border-radius: 10px; }
    
    input, select, textarea { width: 100%; background: #2c2c2e; border: 1px solid #333; padding: 15px; border-radius: 12px; color: white; margin-bottom: 10px; font-size: 16px; }

    .fab { position: fixed; bottom: 30px; right: 20px; width: 55px; height: 55px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 500; font-size: 22px; color: white; cursor: pointer; }
</style>
</head>
<body>

    <div id="ban-screen">
        <i class="fas fa-ban" style="font-size: 60px; color: var(--danger); margin-bottom: 20px;"></i>
        <h2 style="color:white">GÄ°RÄ°Åž QADAÄžANDIR</h2>
        <p id="ban-msg" style="color:#aaa; margin-top:10px;">QaydalarÄ± pozduÄŸunuz Ã¼Ã§Ã¼n banlandÄ±nÄ±z.</p>
    </div>

    <div id="start-screen" onclick="startApp()">
        <i class="fas fa-play-circle" style="font-size: 60px; color: #fff; margin-bottom: 20px;"></i>
        <div style="font-size: 20px; letter-spacing: 2px; color:white;">CASPIAN STORE</div>
        <div style="font-size: 12px; color: #666; margin-top: 10px;">Public Edition</div>
    </div>

    <div id="app" style="display: none;">
        <header>
            <div class="logo">CASPIAN</div>
            <div class="search-box">
                <input type="text" id="search-input" placeholder="ID ilÉ™ axtar..." oninput="handleSearch()">
            </div>
            <div class="id-badge" id="my-id-display" onclick="adminLoginPanel()">ID: YÃ¼klÉ™nir...</div>
        </header>

        <div class="cat-scroll">
            <div class="cat-item active" onclick="filterCat('all', this)">Son Elanlar</div>
            <div class="cat-item" onclick="filterCat('Pubg', this)">Pubg</div>
            <div class="cat-item" onclick="filterCat('Free Fire', this)">Free Fire</div>
            <div class="cat-item" onclick="filterCat('Brawl Stars', this)">Brawl Stars</div>
            <div class="cat-item" onclick="filterCat('Black Russia', this)">Black Russia</div>
            <div class="cat-item" onclick="filterCat('TikTok', this)">TikTok</div>
            <div class="cat-item" onclick="filterCat('Instagram', this)">Instagram</div>
        </div>

        <div class="container" id="ads-container">
            <p style="text-align:center; color:#555; margin-top:50px;">Elanlar yÃ¼klÉ™nir...</p>
        </div>

        <div class="fab" onclick="openModal('addModal')"><i class="fas fa-plus"></i></div>
    </div>

    <div id="addModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-handle"></div>
            <h3>Yeni Elan</h3>
            <select id="a-cat"><option>Pubg</option><option>Free Fire</option><option>Brawl Stars</option><option>Black Russia</option><option>TikTok</option><option>Instagram</option></select>
            <input type="text" id="a-title" placeholder="BaÅŸlÄ±q (mÉ™s: 70 lvl Full)">
            <input type="number" id="a-price" placeholder="QiymÉ™t (AZN)">
            <input type="tel" id="a-wp" placeholder="WhatsApp (994...)">
            <textarea id="a-desc" placeholder="ÆtraflÄ± mÉ™lumat..." rows="3"></textarea>
            <p style="font-size:12px; color:#aaa;">ÅžÉ™killÉ™r (Max 5):</p>
            <input type="file" id="a-imgs" multiple accept="image/*">
            <button class="btn btn-primary" onclick="uploadAndPost()">PaylaÅŸ</button>
            <button class="btn btn-glass" onclick="closeModal('addModal')">LÉ™ÄŸv et</button>
        </div>
    </div>

    <div id="detailModal" class="modal-overlay">
        <div class="modal-content" id="detail-content"></div>
    </div>

    <div id="hotModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-handle"></div>
            <h3>ðŸ”¥ ElanÄ± HOT et</h3>
            <p style="color:#aaa; font-size:12px;">ElanÄ±nÄ±z É™n yuxarÄ±da gÃ¶rÃ¼nÉ™cÉ™k.</p>
            <button class="btn btn-gold" onclick="buyHot(24, 0.49)">24 Saat - 0.49â‚¼</button>
            <button class="btn btn-gold" onclick="buyHot(48, 0.79)">48 Saat - 0.79â‚¼</button>
            <button class="btn btn-gold" onclick="buyHot(72, 1.19)">72 Saat - 1.19â‚¼</button>
            <button class="btn btn-glass" onclick="closeModal('hotModal')">BaÄŸla</button>
        </div>
    </div>

    <div id="adminBanModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-handle"></div>
            <h3>ðŸš« Ä°stifadÉ™Ã§ini Banla</h3>
            <input type="text" id="ban-target-id" readonly style="color:#888;">
            <textarea id="ban-reason-input" placeholder="Ban sÉ™bÉ™bini yazÄ±n..."></textarea>
            <button class="btn btn-danger" onclick="confirmBan()">Banla</button>
            <button class="btn btn-glass" onclick="closeModal('adminBanModal')">LÉ™ÄŸv et</button>
        </div>
    </div>
    
    <div id="yt-player" style="display:none;"></div>

<script type="module">
// --- FIREBASE Ä°NTEQRASÄ°YASI ---
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, getDocs, setDoc, updateDoc, deleteDoc, collection, query, orderBy, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

// --- BURAYA FIREBASE CONFIG KODUNU YAPIÅžDIR ---
const firebaseConfig = {
    apiKey: "AIzaSyApMfvvBLSzhZSRFha81ykdpE4owMPVZMc",
    authDomain: "sonproekt-9fa60.firebaseapp.com",
    projectId: "sonproekt-9fa60",
    storageBucket: "sonproekt-9fa60.firebasestorage.app",
    messagingSenderId: "232991501616",
    appId: "1:232991501616:web:d3e7d9c83110c14a826cf5"
};

// Firebase iÅŸÉ™ salÄ±nÄ±r
let app, db, storage;
try {
    app = initializeApp(firebaseConfig);
    db = getFirestore(app);
    storage = getStorage(app);
    console.log("Firebase uÄŸurla qoÅŸuldu! âœ…");
} catch (e) {
    console.error("Firebase XÉ™tasÄ±: Config dÃ¼zgÃ¼n deyil!", e);
}

let currentUser = null;
let allAds = [];
// Ä°stifadÉ™Ã§i ID-si yaradÄ±lÄ±r (brauzerdÉ™ yadda saxlanÄ±lÄ±r ki, hÉ™r dÉ™fÉ™ dÉ™yiÅŸmÉ™sin)
let myUID = localStorage.getItem('c_uid') || Math.floor(100000 + Math.random() * 900000).toString();
localStorage.setItem('c_uid', myUID);

    // --- BAÅžLATMA ---
    window.startApp = async () => {
        if (!db) return alert("ZÉ™hmÉ™t olmasa koda Firebase Config aÃ§arlarÄ±nÄ± É™lavÉ™ edin!");
        
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('app').style.display = 'block';

        // Musiqi
        const tracks = ['rVkCOfUDCaM', 'PfnJ7lRX0pY', 'zJXhT4sVlK0'];
        const rand = tracks[Math.floor(Math.random()*tracks.length)];
        document.getElementById('yt-player').innerHTML = `<iframe src="https://www.youtube.com/embed/${rand}?autoplay=1&loop=1&playlist=${rand}" allow="autoplay"></iframe>`;

        await checkUser();
        listenAds();
    };

    // Ä°stifadÉ™Ã§i yoxlanÄ±ÅŸÄ± vÉ™ Ban Sistemi
    async function checkUser() {
        const userRef = doc(db, "users", myUID);
        const snap = await getDoc(userRef);

        if (snap.exists()) {
            currentUser = snap.data();
            if (currentUser.banned) {
                document.getElementById('ban-screen').style.display = 'flex';
                document.getElementById('ban-msg').innerText = currentUser.banReason || "QaydalarÄ± pozduÄŸunuz Ã¼Ã§Ã¼n.";
                document.getElementById('app').style.display = 'none';
                return;
            }
        } else {
            currentUser = { id: myUID, isAdmin: false, verified: false, banned: false };
            await setDoc(userRef, currentUser);
        }
        updateHeader();
    }

    function updateHeader() {
        const adminTag = currentUser.isAdmin ? '<span style="color:red; font-weight:bold;"> (ADM)</span>' : '';
        const verifyTag = currentUser.verified ? '<i class="fas fa-check-circle" style="color:#1DA1F2"></i>' : '';
        document.getElementById('my-id-display').innerHTML = `ID: #${myUID} ${verifyTag} ${adminTag}`;
    }

    // ElanlarÄ± DinlÉ™ (Realtime)
    function listenAds() {
        const q = query(collection(db, "ads"), orderBy("time", "desc"));
        onSnapshot(q, (snapshot) => {
            allAds = [];
            snapshot.forEach(doc => allAds.push({ uid: doc.id, ...doc.data() }));
            renderAds(allAds);
        });
    }

    // ElanlarÄ±n Render EdilmÉ™si
    window.renderAds = (ads) => {
        const cont = document.getElementById('ads-container');
        cont.innerHTML = "";
        
        // HOT elanlarÄ± É™n baÅŸa
        const sorted = ads.sort((a, b) => {
            const aHot = (a.isHot && a.hotUntil > Date.now()) ? 1 : 0;
            const bHot = (b.isHot && b.hotUntil > Date.now()) ? 1 : 0;
            return bHot - aHot;
        });

        sorted.forEach(ad => {
            const isHot = ad.isHot && ad.hotUntil > Date.now();
            const isSold = ad.status === 'sold';
            
            // SatÄ±lan elanlar 3 saniyÉ™ sonra silinir, amma hÉ™lÉ™lik gÃ¶rÃ¼nÃ¼rsÉ™ sold-overlay
            if(isSold && !currentUser.isAdmin && ad.sellerId !== myUID) return; // BaÅŸqalarÄ± satÄ±lanÄ± gÃ¶rmÉ™sin

            cont.innerHTML += `
                <div class="ad-card ${isHot ? 'hot' : ''}" onclick="openDetail('${ad.uid}')">
                    ${isHot ? '<div class="hot-badge">ðŸ”¥ HOT</div>' : ''}
                    ${isSold ? '<div class="sold-overlay">SATILDI</div>' : ''}
                    <img src="${ad.imgs[0]}" style="width:100%; height:220px; object-fit:cover;">
                    <div class="ad-content">
                        <div style="display:flex; justify-content:space-between; font-size:12px; color:#888;">
                            <span>${ad.cat}</span>
                            <span>#${ad.sellerId} ${ad.sellerVerified ? '<i class="fas fa-check-circle" style="color:#1DA1F2"></i>' : ''}</span>
                        </div>
                        <h3 class="ad-title">${ad.title}</h3>
                        <div class="ad-price">${ad.price} AZN</div>
                    </div>
                </div>
            `;
        });
    };

    // DetallÄ± BaxÄ±ÅŸ ModalÄ±
    window.openDetail = async (id) => {
        const ad = allAds.find(a => a.uid === id);
        if(!ad) return;

        const isOwner = ad.sellerId === myUID;
        const isAdmin = currentUser.isAdmin;

        let btns = "";
        if (isOwner || isAdmin) {
            btns = `
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;">
                    <button class="btn btn-gold" onclick="openHotModal('${ad.uid}')">HOT Et</button>
                    <button class="btn btn-primary" onclick="markSold('${ad.uid}')">SatÄ±ldÄ±</button>
                    <button class="btn btn-danger" onclick="deleteAd('${ad.uid}')">Sil</button>
                    ${isAdmin ? `<button class="btn btn-danger" onclick="adminBanUser('${ad.sellerId}')">ðŸš« User Ban</button>` : ''}
                </div>
            `;
        } else {
            btns = `
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <button class="btn btn-primary" onclick="contactSeller('${ad.wp}', '${ad.title}')">SatÄ±cÄ±ya Yaz</button>
                    <button class="btn btn-gold" onclick="contactAraci('${ad.uid}', '${ad.sellerId}', '${ad.price}')">AracÄ± ilÉ™ Al</button>
                </div>
                <button class="btn btn-glass" onclick="viewProfile('${ad.sellerId}')">SatÄ±cÄ± ProfilinÉ™ Bax</button>
            `;
        }

        let imgHtml = "";
        ad.imgs.forEach((url, i) => {
            imgHtml += `<img src="${url}" style="width:100%; height:250px; object-fit:cover; border-radius:10px; margin-bottom:10px; display:${i===0?'block':'none'}" class="slide-img" id="s-${i}">`;
        });
        if(ad.imgs.length > 1) imgHtml += `<div style="text-align:center;"><button class="btn-mini" onclick="slide(1)">NÃ¶vbÉ™ti ÅžÉ™kil</button></div>`;

        document.getElementById('detail-content').innerHTML = `
            <div class="modal-handle"></div>
            ${imgHtml}
            <h2>${ad.title}</h2>
            <div style="font-size:24px; color:#30D158; font-weight:bold;">${ad.price} AZN</div>
            <p style="color:#ccc;">${ad.desc}</p>
            <div style="font-size:12px; color:#888;">
                <p>ID: #${ad.uid.slice(0,5)}</p>
                <p>SatÄ±cÄ±: #${ad.sellerId} ${ad.sellerVerified ? 'âœ…' : ''}</p>
            </div>
            ${btns}
            <button class="btn btn-glass" style="margin-top:10px;" onclick="closeModal('detailModal')">BaÄŸla</button>
        `;
        openModal('detailModal');
        window.currentSlide = 0;
        window.totalSlides = ad.imgs.length;
    };

    window.slide = (dir) => {
        document.getElementById(`s-${window.currentSlide}`).style.display = 'none';
        window.currentSlide = (window.currentSlide + dir) % window.totalSlides;
        document.getElementById(`s-${window.currentSlide}`).style.display = 'block';
    }

    // --- FUNKSÄ°YALAR ---

// --- YENÄ° PAYLAÅžMA FUNKSÄ°YASI (STORAGE Ä°STÄ°FADÆ ETMÆDÆN) ---
window.uploadAndPost = async () => {
    const files = document.getElementById('a-imgs').files;
    if (files.length === 0) return alert("ÅžÉ™kil seÃ§in!");

    // ÅžÉ™kli yazÄ±ya (Base64) Ã§evirmÉ™k Ã¼Ã§Ã¼n kÃ¶mÉ™kÃ§i funksiya
    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });

    try {
        let imgs = [];
        // Maksimum 1-2 ÅŸÉ™kil seÃ§mÉ™yÉ™ Ã§alÄ±ÅŸ (baza limiti Ã¼Ã§Ã¼n)
        for (let i = 0; i < files.length; i++) {
            const base64String = await toBase64(files[i]);
            imgs.push(base64String);
        }

        // Firestore-a birbaÅŸa yazÄ±rÄ±q
        await setDoc(doc(collection(db, "ads")), {
            sellerId: myUID,
            isVerified: currentUser.verified,
            cat: document.getElementById('a-cat').value,
            title: document.getElementById('a-title').value,
            price: document.getElementById('a-price').value,
            wp: document.getElementById('a-wp').value,
            desc: document.getElementById('a-desc').value,
            imgs: imgs, // ÅžÉ™killÉ™r artÄ±q link yox, kod ÅŸÉ™klindÉ™ gedir
            isHot: false,
            isSold: false,
            status: "active",
            time: Date.now()
        });

        closeModal('addModal');
        alert("Elan uÄŸurla paylaÅŸÄ±ldÄ±!");
    } catch (e) {
        console.error("XÉ™ta baÅŸ verdi:", e);
        alert("PaylaÅŸmaq mÃ¼mkÃ¼n olmadÄ±. ÅžÉ™kil Ã§ox bÃ¶yÃ¼k ola bilÉ™r (Max 1MB).");
    }
};

    // Hot Sistemi
    window.openHotModal = (id) => { window.targetHotId = id; openModal('hotModal'); closeM('detailModal'); };
    window.buyHot = async (hours, price) => {
        if(currentUser.isAdmin) {
            // Admin pulsuz edir
            const unt = Date.now() + (hours * 3600000);
            await updateDoc(doc(db, "ads", window.targetHotId), { isHot: true, hotUntil: unt });
            alert("Admin: Elan HOT edildi!");
        } else {
            // User Ã¼Ã§Ã¼n WhatsApp
            const msg = `Salam, #${window.targetHotId} elanÄ±nÄ± ${hours} saatlÄ±q HOT etmÉ™k istÉ™yirÉ™m. QiymÉ™t: ${price} AZN.`;
            window.open(`https://wa.me/994771048394?text=${encodeURIComponent(msg)}`);
        }
        closeModal('hotModal');
    };

    // SatÄ±ldÄ± vÉ™ Sil
    window.markSold = async (id) => {
        if(!confirm("Elan SATILDI kimi iÅŸarÉ™lÉ™nsin? (Avtomatik silinÉ™cÉ™k)")) return;
        await updateDoc(doc(db, "ads", id), { status: 'sold' });
        // 3 saniyÉ™ sonra sil
        setTimeout(async () => {
            await deleteDoc(doc(db, "ads", id));
            closeModal('detailModal');
        }, 3000);
    };

    window.deleteAd = async (id) => {
        if(confirm("SilmÉ™k istÉ™diyinÉ™ É™minsÉ™n?")) {
            await deleteDoc(doc(db, "ads", id));
            closeModal('detailModal');
        }
    };

    // Admin Ban Sistemi
    window.adminBanUser = (uid) => {
        document.getElementById('ban-target-id').value = uid;
        openModal('adminBanModal');
    };
    window.confirmBan = async () => {
        const uid = document.getElementById('ban-target-id').value;
        const reason = document.getElementById('ban-reason-input').value;
        await updateDoc(doc(db, "users", uid), { banned: true, banReason: reason });
        alert("Ä°stifadÉ™Ã§i banlandÄ±!");
        closeModal('adminBanModal');
        closeModal('detailModal');
    };

    // Profil vÉ™ AxtarÄ±ÅŸ
    window.viewProfile = async (uid) => {
        const uAds = allAds.filter(a => a.sellerId === uid);
        const userRef = await getDoc(doc(db, "users", uid));
        const uData = userRef.exists() ? userRef.data() : {};
        
        alert(`ðŸ‘¤ PROFÄ°L: #${uid}\nâœ… Verified: ${uData.verified?'BÉ™li':'Xeyr'}\nðŸ“¦ Aktiv Elanlar: ${uAds.length}`);
    };

    window.handleSearch = () => {
        const val = document.getElementById('search-input').value;
        if(val.length < 1) return renderAds(allAds);
        
        // ID-yÉ™ gÃ¶rÉ™ axtarÄ±ÅŸ (User vÉ™ ya Elan)
        const filtered = allAds.filter(a => a.sellerId.includes(val) || a.uid.includes(val));
        renderAds(filtered);
    };

    // ÆlaqÉ™
    window.contactSeller = (wp, title) => {
        if(!confirm("SatÄ±cÄ± ilÉ™ birbaÅŸa É™laqÉ™ zamanÄ± mÉ™suliyyÉ™t sizdÉ™dir!")) return;
        window.open(`https://wa.me/${wp}?text=Salam, "${title}" elanÄ± barÉ™dÉ™ yazÄ±ram.`);
    };
    window.contactAraci = (uid, sid, price) => {
        const msg = `ARACI TÆLÆBÄ°:\nElan ID: ${uid}\nSatÄ±cÄ± ID: ${sid}\nQiymÉ™t: ${price} AZN`;
        window.open(`https://wa.me/994771048394?text=${encodeURIComponent(msg)}`);
    };

    // Admin GiriÅŸ Paneli
    window.adminLoginPanel = async () => {
        if(currentUser.isAdmin) {
             alert("SÉ™n artÄ±q AdminsÉ™n!");
             // Ban listi gÃ¶stÉ™r (sadÉ™ alert ilÉ™)
             const bansQ = query(collection(db, "users"), where("banned", "==", true));
             const snaps = await getDocs(bansQ);
             let msg = "ðŸš« BAN LISTI:\n";
             snaps.forEach(d => msg += `ID: ${d.id} - SÉ™bÉ™b: ${d.data().banReason}\n`);
             if(snaps.empty) msg += "HeÃ§ kim banlanmayÄ±b.";
             const unbanID = prompt(msg + "\nBanÄ± aÃ§maq Ã¼Ã§Ã¼n ID yaz:");
             if(unbanID) {
                 await updateDoc(doc(db, "users", unbanID), { banned: false });
                 alert("Ban aÃ§Ä±ldÄ±!");
             }
        } else {
            const name = prompt("Admin AdÄ±:");
            const pass = prompt("ÅžifrÉ™:");
            if(name === 'Adm19' && pass === 'said01') {
                await updateDoc(doc(db, "users", myUID), { isAdmin: true, verified: true });
                alert("Admin oldunuz! SÉ™hifÉ™ yenilÉ™nir...");
                location.reload();
            }
        }
    };

    // UI KÃ¶mÉ™kÃ§ilÉ™ri
    window.openModal = (id) => document.getElementById(id).style.display = 'flex';
    window.closeModal = (id) => document.getElementById(id).style.display = 'none';
    window.closeM = (id) => document.getElementById(id).style.display = 'none'; // Alias
    window.filterCat = (c, el) => {
        document.querySelectorAll('.cat-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        if(c === 'all') renderAds(allAds);
        else renderAds(allAds.filter(a => a.cat === c));
    };

    // Overlay click close
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
        overlay.addEventListener('click', (e) => {
            if(e.target === overlay) overlay.style.display = 'none';
        });
    });

</script>
</body>
</html>
